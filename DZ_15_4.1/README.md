
# Решение домашнего задания к занятию "4.1. Командная оболочка Bash: Практические навыки"

1. Есть скрипт:
	```bash
	a=1
	b=2
	c=a+b
	d=$a+$b
	e=$(($a+$b))
	```
	* Какие значения переменным c,d,e будут присвоены?
	
	* Почему?
	
	  
	
	  **Ответ:**
	
	a и b - являются неявным определением целочисленного
	
	| Скрипт       | Результат вывода переменной | Пояснение                                                    |
	| ------------ | --------------------------- | ------------------------------------------------------------ |
	| c=a+b        | a+b                         | В данном случае Bash интерплетирует "a+b" как обычным текстом строковой переменной "с". |
	| d=$a+$b      | 1+2                         | По умолчанию, Bash интерплетирует значения переменных как строковые, даже если они состоят из цифр. "$a+$b" в данном случае подстановка команд для строковой переменной "с". |
	| e=$(($a+$b)) | 3                           | В данном случае Bash интерплетирует и производит синтаксический анализ формы $((выражение)) как арифметического выражения, т.о выполняет целоцисленное арифметическую операцию. |
	
	
	
1. На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
	```bash
	while ((1==1)
	do
	curl https://localhost:4757
	if (($? != 0))
	then
	date >> curl.log
	fi
	done
	```
	
	**Ответ:**
```bash
#!/usr/bin/env bash

while ((1==1)) #Добавляем упущенную скобку
do
curl https://localhost:4757
if (($? != 0))
then
date >> curl.log
sleep 2 #Тормозим процесс проверки с интервалом 2 сек чтобы не переполнять резко жесткий диск 
else  #Добавляем условие если curl выполнится успешно, то приостанавливаем дальнейшее выполнение скрипта
break 
fi
done
```

3. Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.

   **Ответ:**

```bash
#!/usr/bin/env bash
array_ip=(192.168.0.1 173.194.222.113 87.250.250.242)
port=80
counter=5
timeout=3

for ip in ${array_ip[@]}
  do
    for ((i=1;i<=$counter;i++))
      do  
        if ( curl -s --connect-timeout $timeout $ip:$port > /dev/null )
          then 
            echo "Host $ip ($i) > TRUE"
            echo "Host $ip ($i) > TRUE" >> log
          else
            echo "Host $ip ($i)> FALSE"
            echo "Host $ip ($i) > FALSE" >> log
        fi
      done
  done
```

4. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается

   **Ответ:**

```bash
#!/usr/bin/env bash
array_ip=(173.194.222.113 87.250.250.242 192.168.0.1)
port=80
counter=5
timeout=3

while ((1==1))
  do
    for ip in ${array_ip[@]}
      do
        for ((i=1;i<=$counter;i++))
          do  
            if ( curl -s --connect-timeout $timeout $ip:$port > /dev/null )
              then 
                echo "Host $ip ($i) > TRUE"
                echo "Host $ip ($i) > TRUE" >> log2
              else
                echo "Host $ip ($i)> FALSE > EXIT"
                echo "Host $ip ($i) > FALSE" >> error
                exit 
            fi
          done
      done
  done
```
